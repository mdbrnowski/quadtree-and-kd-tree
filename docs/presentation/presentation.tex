\documentclass[aspectratio=169,dvipsnames]{beamer}
\usetheme{SimpleDarkBlue}
\usepackage{tikz}
\usepackage{minted}
\usepackage[polish]{babel}
\uselanguage{Polish}
\languagepath{Polish}
\newcommand{\sO}{\mathcal O}

\title{Drzewa czwórkowe i kd-drzewa}
\date{\today}
\author{Michał Dobranowski \and Wiktor Perczak}

\begin{document}
\maketitle

\begin{frame}{Plan prezentacji}
    \tableofcontents
\end{frame}

\section{Przedstawienie problemu}

\begin{frame}{Przedstawienie problemu}
    \begin{columns}

    \column{0.6\textwidth}
    Dany jest zbiór $n$ punktów $P$ na płaszczyźnie. Chcemy odpowiadać na zapytania typu:
    \onslide<2->
    \begin{center}
        \textit{dla zadanych $x_1, x_2, y_1, y_2$ znaleźć punkty $p \in P$ takie, że $x_1 \leq x_p \leq x_2, y_1 \leq y_p \leq y_2$}.
    \end{center}

    \column{0.4\textwidth}
    \centering
    \begin{tikzpicture}
        \pgfmathsetseed{1}
        \onslide<1->
        \foreach \i in {1,...,40} {
            \pgfmathsetmacro\x{rand * 2}
            \pgfmathsetmacro\y{rand * 2}
            \coordinate (P\i) at (\x,\y);
            \fill (P\i) circle (2pt);
        }

        \onslide<2->
        \draw [fill=Fuchsia, opacity=0.3] (-0.3,-1.1) rectangle (2.1,1);
        \fill [color=Fuchsia] (-0.3,-1.1) circle (1.5pt);
        \fill [color=Fuchsia] (2.1,1) circle (1.5pt);
    \end{tikzpicture}

    \end{columns}
\end{frame}

\section{Rozwiązanie trywialne}

\begin{frame}[fragile]{Rozwiązanie trywialne}
    Sprawdzić każdy punkt. Złożoność czasowa zapytania: $\sO(n)$.

    \pause
    \hspace*{\fill}
    \begin{minted}[breaklines]{python}
filter(lambda p: x_1 <= p[0] <= x_2 and y_1 <= p[1] <= y_2, points)
    \end{minted}
    \hspace*{\fill}

    \pause Nie uda nam się poprawić złożoności czasowej, jeśli miałaby zależeć tylko od $n$. Chcemy więc, żeby zależała od liczby punktów wynikowych, którą oznaczymy przez $k$.
\end{frame}

\section{Drzewa czwórkowe}

\begin{frame}{Drzewa czwórkowe -- opis struktury}
    Drzewo czwórkowe (ang. \textit{quadtree}) do drzewiastą struktura danych, w której:
    \begin{enumerate}
        \item<2-> każdy wierzchołek odpowiada za pewnien prostokąt na płaszczyźnie,
        \item<3-> każdy wierzchołek posiada maksymalnie czworo dzieci, z których każdy odpowiada za ćwiartkę prostokątu rodzica,
        \item<4-> każdy liść odpowiada za jeden punkt na płaszczyźnie.
    \end{enumerate}
\end{frame}

\begin{frame}{Drzewa czwórkowe -- sposób podziału}
    \input{quadtree_construction.tex}
\end{frame}

\begin{frame}{Drzewa czwórkowe -- analiza złożoności}
    \begin{lemma}[wysokość drzewa czwórkowego]
        Niech
        \[ \beta = \frac{\max_{p, q\in P} \Vert p-q\Vert}{\min_{p, q\in P, p \neq q} \Vert p-q\Vert}. \]
        Wysokość $h$ drzewa czwórkowego dla zbioru $P$ jest $\Theta(\log\beta)$.
    \end{lemma}

    \pause Warto zauważyć, że $h$ może być nieograniczone przez $n$. W praktyce jest ograniczone dzięki standardowi liczb zmiennoprzecinkowych.

    Łatwo pokazać, że $h$ jest $\Omega(\log n)$ (a jeśli punkty w $P$ są rozłożone równomiernie, to $\Theta(\log n)$).

    \onslide<3->{
        Złożoność
        \begin{enumerate}
        \item konstrukcji drzewa: \onslide<4->{$\sO(hn)$,}
        \item zapytania: \onslide<6->{$\sO(hk)$,}
        \item pamięciowa: \onslide<5->{$\sO(hn)$.}
        \end{enumerate}
    }
\end{frame}

\section{Kd-drzewa}

\begin{frame}{kd-tree -- opis struktury}
    Kd-drzewo (ang. \textit{kd-tree}) to drzewo binarne, w którym:
    \begin{enumerate}
        \item<2-> każdy poziom drzewa odpowiada za wymiar, względem którego dzieli się punkty,
        \item<3-> każdy wierzchołek odpowiada za wartość współrzędnej podziału w danym wymiarze,
        \item<4-> wartość współrzędnej podziału jest przyjmowana jako mediana zbioru (znajdowana za pomocą algorytmu quickselect),
        \item<5-> dla każdego wierzchołka obiekty mniejsze trafiają do lewego potomka, większe do prawego, a równe albo do lewego albo do prawego (dla zrównoważenia drzewa),
        \item<6-> każdy liść odpowiada za jeden punkt na płaszczyźnie.
    \end{enumerate}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/1}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/1.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/2}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/2.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/3}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/3.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/4}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/4.drawio}
    \end{columns}
\end{frame}


\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/4}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/5.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/5}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/6.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/5}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/7.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/6}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/8.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/7}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/9.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/7}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/10.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/8}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/11.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-drzewa -- sposób podziału}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/8}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/12.drawio}
    \end{columns}
\end{frame}

\begin{frame}{kd-tree -- odpowiadanie na zapytania}
    Znajdowanie punktów, które należą do zadanego obszaru działa następująco:
    \begin{enumerate}
        \item<2-> każdy wierzchołek w drzewie (poza liśćmi) odpowiada za konkretny obszar w przestrzeni,
        \item<3-> przeszukuje się drzewo od korzenia -- jeśli obszar z wierzchołka w pełni znajduje się w zadanym obszarze, to uwzględniamy wszystkie jego liście w odpowiedzi,
        \item<4-> jeśli obszar tylko częściowo pokrywa się z zadanym obszarem, to sprawdzamy dalej jego dzieci,
        \item<5-> jesli obszar w ogóle nie pokrywa się z zadanym obszarem to kończymy przeszukiwanie w tym poddrzewie.
    \end{enumerate}
\end{frame}

\begin{frame}{kd-drzewa -- odpowiadanie na zapytania}
    \begin{columns}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/plots/9}
        \column{0.5\textwidth}
        \includegraphics[width=\textwidth]{images/trees/12.drawio}
    \end{columns}
\end{frame}


\begin{frame}{kd-tree -- analiza złożoności}
    Budując drzewo, trzeba w każdym kroku liczyć medianę, co odbywa się w czasie $\sO(n)$.
    Drzewo jest zrównoważone, więc z każdym podziałem zbiór zmniejsza się dwukrotnie,
    więc ostateczna złożoność wynosi $\sO(n \log n)$.

    \pause
    \begin{lemma}[o kd-drzewie]
        Dla zrównoważonego kd-drzewa o zamiennym podziale (czyli takim, gdzie punkt dzielący jest wybierany według różnych wymiarów dla różnych poziomów drzewa), dowolna pionowa lub pozioma prosta przecina $\sO(\sqrt n)$ komórek.
    \end{lemma}

    Złożoność
    \begin{enumerate}
        \item konstrukcji drzewa: $\sO(n\log n)$,
        \item zapytania: $\sO(\sqrt n)$,
        \item pamięciowa: $\sO(n)$.
    \end{enumerate}
\end{frame}

\section{Porównanie}

\end{document}